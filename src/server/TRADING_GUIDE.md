# äº¤æ˜“åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ é—®é¢˜ä¿®å¤è¯´æ˜

### ä¿®å¤çš„é—®é¢˜

1. âœ… **ä½™é¢ä¸è¶³é”™è¯¯**: "ab not enough for new order"
   - åŸå› ï¼šè®¢å•æ•°é‡å¤ªå¤§ï¼Œè¶…è¿‡è´¦æˆ·å¯ç”¨ä½™é¢
   - è§£å†³ï¼šå‡å°‘è®¢å•æ•°é‡æˆ–å……å€¼

2. âœ… **å¹³ä»“ä»·æ ¼é”™è¯¯**: "Price or BBO is required for limit orders"
   - åŸå› ï¼šå¹³ä»“æ—¶æ²¡æœ‰ä¼  price å‚æ•°ï¼Œä½†ç³»ç»Ÿåˆ¤æ–­ä¸ºé™ä»·å•
   - è§£å†³ï¼šå¹³ä»“æ—¶è‡ªåŠ¨ä½¿ç”¨å¸‚ä»·å•ï¼ˆprice='0'ï¼‰

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªåŠ¨å¹³ä»“é€»è¾‘

å½“æ”¶åˆ°å¹³ä»“ä¿¡å·æ—¶ï¼š
- âœ… **ä¸éœ€è¦ä¼  qty**ï¼šç³»ç»Ÿè‡ªåŠ¨æŸ¥è¯¢å½“å‰æŒä»“æ•°é‡
- âœ… **ä¸éœ€è¦ä¼  price**ï¼šè‡ªåŠ¨ä½¿ç”¨å¸‚ä»·å•å¿«é€Ÿå¹³ä»“
- âœ… **å®Œå…¨å¹³ä»“**ï¼šç¡®ä¿å¹³æ‰æ‰€æœ‰æŒä»“

**ç¤ºä¾‹**ï¼š
```javascript
// å¹³å¤šä»“ - åªéœ€è¦ä¼  symbol å’Œ side
{
  "symbol": "ETHUSDT",
  "side": "EXIT_LONG"
}

// ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
// 1. æŸ¥è¯¢ ETHUSDT çš„å¤šä»“æŒä»“æ•°é‡
// 2. ä½¿ç”¨å¸‚ä»·å•å¹³æ‰æ‰€æœ‰æŒä»“
```

### 2. è®¢å•ç±»å‹åˆ¤æ–­

```javascript
// å¸‚ä»·å•ï¼ˆå¿«é€Ÿæˆäº¤ï¼‰
price: undefined  // ä¸ä¼ 
price: null
price: ""
price: "0"

// é™ä»·å•ï¼ˆæŒ‡å®šä»·æ ¼ï¼‰
price: "3400.5"
```

## ğŸ“Š å®Œæ•´äº¤æ˜“æµç¨‹

### å¼€ä»“æµç¨‹

```javascript
// 1. å¼€å¤šä»“ï¼ˆåšå¤šï¼‰
POST /webhook
{
  "symbol": "ETHUSDT",
  "side": "ENTER_LONG",
  "qty": "0.01",      // å¿…é¡»ä¼ ï¼Œæ•°é‡
  "price": "0"        // å¯é€‰ï¼Œä¸ä¼ æˆ–"0"ä¸ºå¸‚ä»·å•
}

// 2. å¼€ç©ºä»“ï¼ˆåšç©ºï¼‰
POST /webhook
{
  "symbol": "ETHUSDT",
  "side": "ENTER_SHORT",
  "qty": "0.01",
  "price": "3400"     // å¯é€‰ï¼Œä¼ å…·ä½“ä»·æ ¼ä¸ºé™ä»·å•
}
```

### å¹³ä»“æµç¨‹

```javascript
// 1. å¹³å¤šä»“
POST /webhook
{
  "symbol": "ETHUSDT",
  "side": "EXIT_LONG"
  // qty ä¸ä¼ ï¼Œè‡ªåŠ¨æŸ¥è¯¢æŒä»“
  // price ä¸ä¼ ï¼Œè‡ªåŠ¨ä½¿ç”¨å¸‚ä»·å•
}

// 2. å¹³ç©ºä»“
POST /webhook
{
  "symbol": "ETHUSDT",
  "side": "EXIT_SHORT"
  // qty ä¸ä¼ ï¼Œè‡ªåŠ¨æŸ¥è¯¢æŒä»“
  // price ä¸ä¼ ï¼Œè‡ªåŠ¨ä½¿ç”¨å¸‚ä»·å•
}
```

## ğŸ”§ å·¥å…·è„šæœ¬

### 1. æŸ¥è¯¢è´¦æˆ·ä½™é¢å’ŒæŒä»“

```bash
cd src/server
node checkBalance.js
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ’° è´¦æˆ·ä½™é¢ä¿¡æ¯:
============================================================

å¸ç§: USDT
  æ€»æƒç›Š: 100.50
  å¯ç”¨ä½™é¢: 95.30
  é’±åŒ…ä½™é¢: 100.50

============================================================

ğŸ“Š å½“å‰æŒä»“ä¿¡æ¯:
============================================================

äº¤æ˜“å¯¹: ETHUSDT
  æ–¹å‘: Buy
  æ•°é‡: 0.1
  å¼€ä»“ä»·: 3400.50
  æ ‡è®°ä»·: 3410.20
  æœªå®ç°ç›ˆäº: 0.97
  æ æ†: 1x

============================================================

ğŸ“ æ ¹æ®å½“å‰ä½™é¢ï¼Œå»ºè®®çš„è®¢å•æ•°é‡:

ğŸ’¡ å»ºè®®è®¢å•å‚æ•°:
  äº¤æ˜“å¯¹: ETHUSDT
  å¯ç”¨ä½™é¢: 95.30 USDT
  ä»·æ ¼: 3400
  æ æ†: 1x
  é£é™©æ¯”ä¾‹: 10%
  å»ºè®®æ•°é‡: 0.03
  é¢„è®¡å ç”¨ä¿è¯é‡‘: 9.53 USDT
```

### 2. æµ‹è¯•äº¤æ˜“åŠŸèƒ½

```bash
cd src/server

# æµ‹è¯•å¼€å¤šä»“
node test.js open

# æµ‹è¯•å¹³å¤šä»“
node test.js close

# æµ‹è¯•å¼€ç©ºä»“
node test.js opendown

# æµ‹è¯•å¹³ç©ºä»“
node test.js closedown
```

## ğŸ’¡ å®‰å…¨å»ºè®®

### 1. è®¢å•æ•°é‡è®¡ç®—

æ ¹æ®è´¦æˆ·ä½™é¢è®¡ç®—å®‰å…¨çš„è®¢å•æ•°é‡ï¼š

```javascript
// å…¬å¼
å®‰å…¨æ•°é‡ = (å¯ç”¨ä½™é¢ Ã— é£é™©æ¯”ä¾‹ Ã— æ æ†) / ä»·æ ¼

// ç¤ºä¾‹ï¼š
// å¯ç”¨ä½™é¢: 100 USDT
// é£é™©æ¯”ä¾‹: 10% (ä½¿ç”¨10%çš„èµ„é‡‘)
// æ æ†: 1x
// ETHä»·æ ¼: 3400 USDT

å®‰å…¨æ•°é‡ = (100 Ã— 0.1 Ã— 1) / 3400 = 0.0029 ETH
```

### 2. æ¨èé…ç½®

| è´¦æˆ·ä½™é¢ | ETHæ•°é‡ (ä»·æ ¼3400) | BTCæ•°é‡ (ä»·æ ¼50000) |
|---------|-------------------|-------------------|
| 10 USDT | 0.001 | 0.0001 |
| 50 USDT | 0.01 | 0.0005 |
| 100 USDT | 0.02 | 0.001 |
| 500 USDT | 0.1 | 0.005 |
| 1000 USDT | 0.2 | 0.01 |

### 3. é£é™©æ§åˆ¶

- âœ… **å•ç¬”è®¢å•ä¸è¶…è¿‡è´¦æˆ·çš„10-20%**
- âœ… **ä½¿ç”¨æ­¢æŸæ­¢ç›ˆ**
- âœ… **æµ‹è¯•ç½‘å…ˆæµ‹è¯•**
- âœ… **å°æ•°é‡å¼€å§‹**

## ğŸ› å¸¸è§é”™è¯¯å¤„ç†

### 1. "ab not enough for new order"

**åŸå› **ï¼šè´¦æˆ·ä½™é¢ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æŸ¥è¯¢å½“å‰ä½™é¢
node checkBalance.js

# 2. å‡å°‘è®¢å•æ•°é‡
# å°† qty: "0.1" æ”¹ä¸º qty: "0.01"

# 3. æˆ–è€…å……å€¼åˆ°è´¦æˆ·
```

### 2. "Price or BBO is required for limit orders"

**åŸå› **ï¼šé™ä»·å•ç¼ºå°‘ä»·æ ¼å‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ–¹æ¡ˆ1: ä½¿ç”¨å¸‚ä»·å•ï¼ˆæ¨èå¹³ä»“æ—¶ä½¿ç”¨ï¼‰
{
  "price": "0"  // æˆ–ä¸ä¼  price
}

// æ–¹æ¡ˆ2: ä½¿ç”¨é™ä»·å•
{
  "price": "3400.5"  // ä¼ å…·ä½“ä»·æ ¼
}
```

### 3. "current position is zero, cannot fix reduce-only order qty"

**åŸå› **ï¼šæ²¡æœ‰æŒä»“ï¼Œæ— æ³•å¹³ä»“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æŸ¥è¯¢å½“å‰æŒä»“
node checkBalance.js

# 2. ç¡®è®¤æœ‰æŒä»“åå†å¹³ä»“
# æˆ–è€…å…ˆå¼€ä»“å†å¹³ä»“
```

### 4. "timestamp or recv_window error"

**åŸå› **ï¼šæœ¬åœ°æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… ä»£ç å·²è‡ªåŠ¨å¤„ç†æ—¶é—´åŒæ­¥
- âœ… å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„äº¤æ˜“æµç¨‹ç¤ºä¾‹

```javascript
const axios = require('axios');
const BASE_URL = 'http://localhost:3000';

// 1. å¼€å¤šä»“
async function openLong() {
  const response = await axios.post(`${BASE_URL}/webhook`, {
    symbol: 'ETHUSDT',
    side: 'ENTER_LONG',
    qty: '0.01',
    price: '0'  // å¸‚ä»·å•
  });
  console.log('å¼€ä»“æˆåŠŸ:', response.data);
}

// 2. å¹³å¤šä»“
async function closeLong() {
  const response = await axios.post(`${BASE_URL}/webhook`, {
    symbol: 'ETHUSDT',
    side: 'EXIT_LONG'
    // ä¸ä¼  qty å’Œ priceï¼Œè‡ªåŠ¨å¹³ä»“
  });
  console.log('å¹³ä»“æˆåŠŸ:', response.data);
}

// 3. å¸¦æ­¢ç›ˆæ­¢æŸçš„å¼€ä»“
async function openWithTPSL() {
  const response = await axios.post(`${BASE_URL}/webhook`, {
    symbol: 'ETHUSDT',
    side: 'ENTER_LONG',
    qty: '0.01',
    price: '3400',
    takeProfit: '3500',  // æ­¢ç›ˆä»·
    stopLoss: '3300'     // æ­¢æŸä»·
  });
  console.log('å¼€ä»“æˆåŠŸ:', response.data);
}

// æ‰§è¡Œ
async function main() {
  try {
    await openLong();
    // ç­‰å¾…ä¸€æ®µæ—¶é—´
    await new Promise(resolve => setTimeout(resolve, 5000));
    await closeLong();
  } catch (error) {
    console.error('äº¤æ˜“å¤±è´¥:', error.response?.data || error.message);
  }
}

main();
```

## ğŸš€ æœ€ä½³å®è·µ

### 1. æµ‹è¯•æµç¨‹

```bash
# æ­¥éª¤1: æ£€æŸ¥ä½™é¢
node checkBalance.js

# æ­¥éª¤2: å°æ•°é‡æµ‹è¯•å¼€ä»“
node test.js open

# æ­¥éª¤3: æµ‹è¯•å¹³ä»“
node test.js close

# æ­¥éª¤4: ç¡®è®¤æ— è¯¯åä½¿ç”¨å®é™…æ•°é‡
```

### 2. ç”Ÿäº§ç¯å¢ƒå»ºè®®

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç† API Key
- âœ… æ·»åŠ æ—¥å¿—è®°å½•
- âœ… è®¾ç½®å‘Šè­¦é€šçŸ¥
- âœ… å®šæœŸæ£€æŸ¥æŒä»“å’Œä½™é¢
- âœ… ä½¿ç”¨æ­¢æŸæ­¢ç›ˆä¿æŠ¤

### 3. TradingView é›†æˆ

```javascript
// TradingView Webhook URL
http://your-server:3000/webhook

// Alert Message (å¼€å¤šä»“)
{
  "symbol": "{{ticker}}",
  "side": "ENTER_LONG",
  "qty": "0.01",
  "price": "0"
}

// Alert Message (å¹³å¤šä»“)
{
  "symbol": "{{ticker}}",
  "side": "EXIT_LONG"
}
```

## ğŸ“„ è®¸å¯è¯

MIT

